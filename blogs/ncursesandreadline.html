<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ncurses And GNU Readline</title>
<meta name="author" content="Ashley Barrell" />
<meta name="description" content="Tutorial for how to use GNU readline in an ncurses program" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="/css/hydehyde.css"/><link rel="stylesheet" href="/css/codestyle.css"/><script type="text/JavaScript" src="/js/mode.js"></script><script type="text/JavaScript" src="/js/magnify.js"></script>
</head>
<body>
<div id="" class="nil">
<div class="sidebar">
<div class="sidebar-about">
  <span class="site__title">
    <a href="https://barrolskii.github.io/">Ashley Barrell</a>
  </span>
  <div class="author-image">
    <!--<img src="" alt="Author Image" class="img--circle img--headshot element--center">-->
  </div>
    <p class="site__description"></p>
  </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Ashley Barrell</label>
      <div class="menu-content">
        <ul class="sidebar-nav">
          <li>
            <a href="/blogindex.html">
              <span>Blog</span>
            </a>
          </li>
          <li>
           <a href="/projects.html">
            <span>Projects</span>
           </a>
         </li>
         <li>
           <a href="/about.html">
             <span>About</span>
           </a>
         </li>
       </ul>
       <section class="social">
         <a onclick="ToggleMode()">
           <svg class="svg-inline--fa fa-github fa-w-16 fa-lg" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg="">
               <path fill="currentColor" d="M256 0C114.842 0 0 114.842 0 256s114.842 256 256 256 256-114.842 256-256S397.158 0 256 0z"/>
  <path fill="var(--sidebar-bg)" d="M366.465 172.539c-8.555-9.596-23.267-10.437-32.86-1.885-9.595 8.552-10.439 23.263-1.887 32.858 16.561 18.576 25.681 42.53 25.684 67.449 0 55.915-45.489 101.402-101.402 101.402s-101.402-45.487-101.402-101.402c0-24.919 9.121-48.873 25.682-67.449 8.553-9.595 7.709-24.306-1.885-32.86-9.593-8.553-24.306-7.711-32.858 1.885-24.173 27.113-37.485 62.068-37.485 98.422 0 81.58 66.369 147.949 147.948 147.949S403.948 352.54 403.948 270.96c-.003-36.355-13.315-71.308-37.483-98.421z"/>
  <path fill="var(--sidebar-bg)" d="M256 239.376c12.853 0 23.273-10.418 23.273-23.273v-99.739c0-12.853-10.42-23.273-23.273-23.273s-23.273 10.42-23.273 23.273v99.739c0 12.854 10.42 23.273 23.273 23.273z"/>
  <path fill="var(--sidebar-bg)" d="M403.948 270.96c-.003-36.355-13.315-71.308-37.483-98.42-8.555-9.596-23.267-10.437-32.86-1.885-9.595 8.552-10.439 23.263-1.887 32.858 16.561 18.576 25.681 42.53 25.684 67.449 0 55.915-45.489 101.402-101.402 101.402v46.545c81.579 0 147.948-66.369 147.948-147.949zm-124.675-54.857v-99.739c0-12.853-10.42-23.273-23.273-23.273v146.285c12.853 0 23.273-10.419 23.273-23.273z"/>
<path fill="currentColor" d="M256 0v93.091c12.853 0 23.273 10.42 23.273 23.273v99.739c0 12.854-10.42 23.273-23.273 23.273v132.988c55.913 0 101.402-45.487 101.402-101.402-.003-24.919-9.123-48.873-25.684-67.449-8.553-9.595-7.708-24.306 1.887-32.858 9.593-8.552 24.304-7.711 32.86 1.885 24.168 27.113 37.48 62.065 37.483 98.42 0 81.58-66.369 147.949-147.948 147.949V512c141.158 0 256-114.842 256-256S397.158 0 256 0z"/>
              </svg>
            </a>

            <a href="https://github.com/barrolskii">
                <svg class="svg-inline--fa fa-github fa-w-16 fa-lg" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg="">
                <path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z">
                </path>
                </svg>
            </a>
            <a href="https://linkedin.com/in/ashley-barrell-0a8804176">
                <svg class="svg-inline--fa fa-linkedin fa-w-14 fa-lg" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg="">
                <path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z">
                </path>
                </svg>
            </a>
            </social>
        </div>
    </div>
</div>
</div>
<div id="nil" class="content container">
<div id="outline-container-orgddcff44" class="outline-2">
<h2 id="orgddcff44">Ncurses And GNU Readline</h2>
<div class="outline-text-2" id="text-orgddcff44">
<div class="post__meta">
<svg class="svg-inline--fa fa-calendar-alt fa-w-14" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="calendar-alt" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M0 464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V192H0v272zm320-196c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM192 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM64 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zM400 64h-48V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H160V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H48C21.5 64 0 85.5 0 112v48h448v-48c0-26.5-21.5-48-48-48z"></path></svg>
JUL 31, 2023
</div>

<p>
Getting Ncurses and GNU Readline to work together might seem like a bit of a pain when
trying to make a Ncurses application that uses Readline for autocompletion. This tutorial
will walk you through how to set up both libraries so you can easily have autocompletion in
your Ncurses applications.
</p>
</div>
<div id="outline-container-org76e1e04" class="outline-3">
<h3 id="org76e1e04">Ncurses Setup</h3>
<div class="outline-text-3" id="text-org76e1e04">
<p>
To start we&rsquo;ll set up a basic ncurses program:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">ncurses.h</span><span style="color: #51afef;">&gt;</span>

<span style="color: #ECBE7B;">WINDOW</span> *<span style="color: #dcaeea;">input_window</span>, *<span style="color: #dcaeea;">output_window</span>;
<span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">lines</span>, <span style="color: #dcaeea;">cols</span>;

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">init_ncurses</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    initscr<span style="color: #c678dd;">()</span>;
    cbreak<span style="color: #c678dd;">()</span>;
    noecho<span style="color: #c678dd;">()</span>;
    keypad<span style="color: #c678dd;">(</span>stdscr, <span style="color: #a9a1e1;">TRUE</span><span style="color: #c678dd;">)</span>;

    getmaxyx<span style="color: #c678dd;">(</span>stdscr, lines, cols<span style="color: #c678dd;">)</span>;

    <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">start_x</span> = <span style="color: #da8548; font-weight: bold;">0</span>;
    <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">start_y</span> = <span style="color: #da8548; font-weight: bold;">0</span>;

    input_window  = newwin<span style="color: #c678dd;">(</span><span style="color: #da8548; font-weight: bold;">3</span>, cols, lines-<span style="color: #da8548; font-weight: bold;">3</span>, start_x<span style="color: #c678dd;">)</span>;
    output_window = newwin<span style="color: #c678dd;">(</span>lines - <span style="color: #da8548; font-weight: bold;">3</span>, cols, start_y, start_x<span style="color: #c678dd;">)</span>;

    keypad<span style="color: #c678dd;">(</span>input_window, <span style="color: #a9a1e1;">TRUE</span><span style="color: #c678dd;">)</span>;
    keypad<span style="color: #c678dd;">(</span>output_window, <span style="color: #a9a1e1;">TRUE</span><span style="color: #c678dd;">)</span>;

    box<span style="color: #c678dd;">(</span>input_window, <span style="color: #da8548; font-weight: bold;">0</span>, <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>;
    box<span style="color: #c678dd;">(</span>output_window, <span style="color: #da8548; font-weight: bold;">0</span>, <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>;

    refresh<span style="color: #c678dd;">()</span>;
    wrefresh<span style="color: #c678dd;">(</span>input_window<span style="color: #c678dd;">)</span>;
    wrefresh<span style="color: #c678dd;">(</span>output_window<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">cleanup_ncurses</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    delwin<span style="color: #c678dd;">(</span>input_window<span style="color: #c678dd;">)</span>;
    delwin<span style="color: #c678dd;">(</span>output_window<span style="color: #c678dd;">)</span>;
    endwin<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">main_loop</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">ch</span> = getch<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    init_ncurses<span style="color: #c678dd;">()</span>;
    main_loop<span style="color: #c678dd;">()</span>;
    cleanup_ncurses<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<p>
This program simply draws 2 boxes, one for displaying output and one for accepting input. We have a
main loop function set up too that just waits for us to enter some input. This will do a bit more later
on in the tutorial but for now it just gets a single character from the user.
</p>
</div>
</div>
<div id="outline-container-orgaf37bb0" class="outline-3">
<h3 id="orgaf37bb0">Readline Setup</h3>
<div class="outline-text-3" id="text-orgaf37bb0">
<p>
Next we need to setup readline and change some readline variables to make sure that it plays nicely with
ncurses:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">stdbool.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">stdlib.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">ncurses.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">readline/readline.h</span><span style="color: #51afef;">&gt;</span>

<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #c678dd;">UNUSED</span><span style="color: #51afef;">(</span><span style="color: #dcaeea;">x</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>x

<span style="color: #ECBE7B;">WINDOW</span> *<span style="color: #dcaeea;">input_window</span>, *<span style="color: #dcaeea;">output_window</span>;
<span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">lines</span>, <span style="color: #dcaeea;">cols</span>;

<span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">char</span> <span style="color: #dcaeea;">input</span>;
<span style="color: #ECBE7B;">bool</span> <span style="color: #dcaeea;">input_available</span> = <span style="color: #a9a1e1;">false</span>;

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">init_ncurses</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    initscr<span style="color: #c678dd;">()</span>;
    cbreak<span style="color: #c678dd;">()</span>;
    noecho<span style="color: #c678dd;">()</span>;
    keypad<span style="color: #c678dd;">(</span>stdscr, <span style="color: #a9a1e1;">TRUE</span><span style="color: #c678dd;">)</span>;

    getmaxyx<span style="color: #c678dd;">(</span>stdscr, lines, cols<span style="color: #c678dd;">)</span>;

    <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">start_x</span> = <span style="color: #da8548; font-weight: bold;">0</span>;
    <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">start_y</span> = <span style="color: #da8548; font-weight: bold;">0</span>;

    input_window  = newwin<span style="color: #c678dd;">(</span><span style="color: #da8548; font-weight: bold;">3</span>, cols, lines-<span style="color: #da8548; font-weight: bold;">3</span>, start_x<span style="color: #c678dd;">)</span>;
    output_window = newwin<span style="color: #c678dd;">(</span>lines - <span style="color: #da8548; font-weight: bold;">3</span>, cols, start_y, start_x<span style="color: #c678dd;">)</span>;

    keypad<span style="color: #c678dd;">(</span>input_window, <span style="color: #a9a1e1;">TRUE</span><span style="color: #c678dd;">)</span>;
    keypad<span style="color: #c678dd;">(</span>output_window, <span style="color: #a9a1e1;">TRUE</span><span style="color: #c678dd;">)</span>;

    box<span style="color: #c678dd;">(</span>input_window, <span style="color: #da8548; font-weight: bold;">0</span>, <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>;
    box<span style="color: #c678dd;">(</span>output_window, <span style="color: #da8548; font-weight: bold;">0</span>, <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>;

    refresh<span style="color: #c678dd;">()</span>;
    wrefresh<span style="color: #c678dd;">(</span>input_window<span style="color: #c678dd;">)</span>;
    wrefresh<span style="color: #c678dd;">(</span>output_window<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">cleanup_ncurses</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    delwin<span style="color: #c678dd;">(</span>input_window<span style="color: #c678dd;">)</span>;
    delwin<span style="color: #c678dd;">(</span>output_window<span style="color: #c678dd;">)</span>;
    endwin<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">forward_to_readline</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">char</span> <span style="color: #dcaeea;">c</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    input = c;
    input_available = <span style="color: #a9a1e1;">true</span>;
    rl_callback_read_char<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">readline_getc</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">FILE</span> *<span style="color: #dcaeea;">fp</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    <span style="color: #a9a1e1;">UNUSED</span><span style="color: #c678dd;">(</span>fp<span style="color: #c678dd;">)</span>;

    input_available = <span style="color: #a9a1e1;">false</span>;
    <span style="color: #51afef;">return</span> input;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">readline_is_input_available</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    <span style="color: #51afef;">return</span> input_available;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">redisplay</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    werase<span style="color: #c678dd;">(</span>input_window<span style="color: #c678dd;">)</span>;
    box<span style="color: #c678dd;">(</span>input_window, <span style="color: #da8548; font-weight: bold;">0</span>, <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>;
    mvwprintw<span style="color: #c678dd;">(</span>input_window, <span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #98be65;">"%s%s"</span>, rl_display_prompt, rl_line_buffer<span style="color: #c678dd;">)</span>;

    wrefresh<span style="color: #c678dd;">(</span>input_window<span style="color: #c678dd;">)</span>;
    wrefresh<span style="color: #c678dd;">(</span>output_window<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">callback_handler</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">line</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    <span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">prev_line</span> = <span style="color: #a9a1e1;">NULL</span>;

    <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #51afef; font-weight: bold;">!</span>line<span style="color: #c678dd;">)</span>
        <span style="color: #51afef;">return</span>;

    free<span style="color: #c678dd;">(</span>prev_line<span style="color: #c678dd;">)</span>;
    prev_line = line;

    redisplay<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">init_readline</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    <span style="color: #5B6268;">/* </span><span style="color: #5B6268;">Allow ncurses to deal with signal handling and term prep</span><span style="color: #5B6268;"> */</span>
    rl_catch_signals  = <span style="color: #da8548; font-weight: bold;">0</span>;
    rl_catch_sigwinch = <span style="color: #da8548; font-weight: bold;">0</span>;

    rl_prep_term_function   = <span style="color: #a9a1e1;">NULL</span>;
    rl_deprep_term_function = <span style="color: #a9a1e1;">NULL</span>;

    <span style="color: #5B6268;">/* </span><span style="color: #5B6268;">Stop readline from changing the lines and cols environment variables</span><span style="color: #5B6268;"> */</span>
    rl_change_environment = <span style="color: #da8548; font-weight: bold;">0</span>;

    rl_getc_function = readline_getc;
    rl_input_available_hook = readline_is_input_available;
    rl_redisplay_function = redisplay;

    rl_callback_handler_install<span style="color: #c678dd;">(</span><span style="color: #98be65;">"&gt; "</span>, callback_handler<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">cleanup_readline</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    rl_callback_handler_remove<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">main_loop</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">ch</span> = getch<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    init_ncurses<span style="color: #c678dd;">()</span>;
    init_readline<span style="color: #c678dd;">()</span>;

    main_loop<span style="color: #c678dd;">()</span>;

    cleanup_readline<span style="color: #c678dd;">()</span>;
    cleanup_ncurses<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<p>
In the init readline function we set the catch signals variables to 0, the term prep function pointers to
NULL, and the change environment variable to 0. This is so ncurses can handle terminal setup and cleanup
along with signal handling. The next thing we change are the 3 following function pointers:
</p>

<ul class="org-ul">
<li>rl_getc_function</li>
<li>rl_input_available_hook</li>
<li>rl_redisplay_function</li>
</ul>

<p>
These functions are very simple, rl_getc_function is the input handler for readline to get a single
character. rl_input_available_hook is the function that is used to check if input is available and
rl_redisplay_function is used to redraw the current frame on screen. We will also need to call the
function rl_callback_handler_install as readline does not allow us to use rl_getc_function without
having a callback handler.
</p>

<p>
We&rsquo;ve added a few new functions to the program and I&rsquo;ll explain what each of them do. The
forward_to_readline function simply updates the global input character to the entered character and sets
the input_available variable to true. We then call the rl_callback_read_char function to allow readline
to consume the character.
</p>

<p>
The readline_getc function simply sets the input_available variable to false and returns the global input
character. This is the function that is called when we call the rl_callback_read_char function. The next
two functions are pretty self explanatory. readline_is_input_available just returns the input_available
variable. We need to wrap this in a function so readline can check if input is actually available. The
redisplay function simply calls wrefresh on both the input and output windows.
</p>

<p>
The callback_handler function is the function that readline will use when we press the enter key. The
line of text that has been entered will be passed to this function and it is up to us to do something
with it. This function contains a single static variable called prev_line. This is because we need to
keep track of the line as it will be replaced the next time this function is called. Readline heap
allocates the line argument so if we don&rsquo;t keep track of the line and free the memory when it is going
to be replaced we will leak memory. That&rsquo;s why just after the NULL check in the function we&rsquo;re freeing
the prev_line variable and then setting prev_line to the current line. We only need to free the memory
in this function when we&rsquo;re replacing the current line. Readline will free the memory that line was
pointing to but won&rsquo;t free any replacements.
</p>
</div>
</div>
<div id="outline-container-orga56307f" class="outline-3">
<h3 id="orga56307f">Updating The Main Loop</h3>
<div class="outline-text-3" id="text-orga56307f">
<p>
Now that we&rsquo;ve setup both ncurses and readline we can now update the main loop function to make use of the
readline library.
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">main_loop</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">ch</span>;
    <span style="color: #51afef;">while</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span>ch = wgetch<span style="color: #a9a1e1;">(</span>input_window<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">{</span>
        <span style="color: #51afef;">switch</span><span style="color: #98be65;">(</span>ch<span style="color: #98be65;">)</span>
        <span style="color: #98be65;">{</span>
            <span style="color: #51afef;">case</span> <span style="color: #a9a1e1;">KEY_BACKSPACE</span>:
                forward_to_readline<span style="color: #a9a1e1;">(</span><span style="color: #da8548; font-weight: bold;">127</span><span style="color: #a9a1e1;">)</span>;
                <span style="color: #51afef;">break</span>;
            <span style="color: #51afef;">default</span>:
                forward_to_readline<span style="color: #a9a1e1;">(</span>ch<span style="color: #a9a1e1;">)</span>;
        <span style="color: #98be65;">}</span>
    <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>
</pre>
</div>

<p>
We are specifically passing the ascii backspace code for delete to readline as realine expects character
codes to be in ascii format.
</p>

<p>
If you run the program now you&rsquo;ll be able to use readline but it still won&rsquo;t be great to use&#x2026; If you try
pressing tab now readline will just display whatever files are in the current directory and it will draw
over our windows. Let&rsquo;s fix that!
</p>
</div>
</div>
<div id="outline-container-orgfb450af" class="outline-3">
<h3 id="orgfb450af">Updating Readline Display Options</h3>
<div class="outline-text-3" id="text-orgfb450af">
<p>
There is a very easy way to stop readline from printing the possible matches it finds by passing a
callback to the rl_completion_display_matches_hook function pointer. We simply add this line to the
init_readline function:
</p>

<div class="org-src-container">
<pre class="src src-C">rl_completion_display_matches_hook = matches_suggestion_display;
</pre>
</div>

<p>
And the function to display the completion options looks like this:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">matches_suggestion_display</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">char</span> **<span style="color: #dcaeea;">matches</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">size</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">len</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    <span style="color: #a9a1e1;">UNUSED</span><span style="color: #c678dd;">(</span>len<span style="color: #c678dd;">)</span>;
    <span style="color: #a9a1e1;">UNUSED</span><span style="color: #c678dd;">(</span>size<span style="color: #c678dd;">)</span>;

    werase<span style="color: #c678dd;">(</span>output_window<span style="color: #c678dd;">)</span>;
    box<span style="color: #c678dd;">(</span>output_window, <span style="color: #da8548; font-weight: bold;">0</span>, <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>;

    <span style="color: #51afef;">for</span> <span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span> = <span style="color: #da8548; font-weight: bold;">0</span>; matches<span style="color: #98be65;">[</span>i<span style="color: #98be65;">]</span>; ++i<span style="color: #c678dd;">)</span>
        mvwprintw<span style="color: #c678dd;">(</span>output_window, <span style="color: #da8548; font-weight: bold;">1</span> + i, <span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #98be65;">"%s"</span>, matches<span style="color: #98be65;">[</span>i<span style="color: #98be65;">]</span><span style="color: #c678dd;">)</span>;

    wrefresh<span style="color: #c678dd;">(</span>output_window<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orga4ded9a" class="outline-3">
<h3 id="orga4ded9a">Adding Custom Completion Options</h3>
<div class="outline-text-3" id="text-orga4ded9a">
<p>
Now when we hit tab to autocomplete Readline will show a list of what is in the current
directory. This is the default behaviour of Readline and for this tutorial is not really that
useful for us so let&rsquo;s change that! First let&rsquo;s add a list of names that we want:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">my_match_list</span><span style="color: #51afef;">[]</span> = <span style="color: #51afef;">{</span>
    <span style="color: #98be65;">"Darth Vader"</span>,
    <span style="color: #98be65;">"Darth Sidious"</span>,
    <span style="color: #98be65;">"Han Solo"</span>,
    <span style="color: #98be65;">"Luke Skywalker"</span>,
    <span style="color: #98be65;">"Obi Wan Kenobi"</span>,
    <span style="color: #98be65;">"Princess Leia"</span>,
    <span style="color: #a9a1e1;">NULL</span> <span style="color: #5B6268;">/* </span><span style="color: #5B6268;">Last item has to be NULL for Readline</span><span style="color: #5B6268;"> */</span>
<span style="color: #51afef;">}</span>;
</pre>
</div>

<p>
Next we want to add 2 new functions. These will handle checking our list of names and return
any and all matches when the user hits tab:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #ECBE7B;">char</span> *<span style="color: #c678dd;">matches_completion_generator</span><span style="color: #51afef;">(</span><span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">text</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">state</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    <span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">index</span>, <span style="color: #dcaeea;">len</span>;
    <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">name</span> = <span style="color: #a9a1e1;">NULL</span>;

    <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #51afef; font-weight: bold;">!</span>state<span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">{</span>
        index = <span style="color: #da8548; font-weight: bold;">0</span>;
        len = strlen<span style="color: #98be65;">(</span>text<span style="color: #98be65;">)</span>;
    <span style="color: #c678dd;">}</span>

    <span style="color: #51afef;">while</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span>name = my_match_list<span style="color: #a9a1e1;">[</span>index++<span style="color: #a9a1e1;">]</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">{</span>
        <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>strncmp<span style="color: #a9a1e1;">(</span>name, text, len<span style="color: #a9a1e1;">)</span> == <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">{</span>
            <span style="color: #51afef;">return</span> strdup<span style="color: #a9a1e1;">(</span>name<span style="color: #a9a1e1;">)</span>;
        <span style="color: #98be65;">}</span>
    <span style="color: #c678dd;">}</span>

    <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">NULL</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">char</span> **<span style="color: #c678dd;">match_completion</span><span style="color: #51afef;">(</span><span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">text</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">start</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">end</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    rl_attempted_completion_over = <span style="color: #da8548; font-weight: bold;">1</span>;
    <span style="color: #51afef;">return</span> rl_completion_matches<span style="color: #c678dd;">(</span>text, matches_completion_generator<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<p>
Finally we need to update the init_readline function to tell Readline that we have our own
function for dealing with matches. We also modify the rl_basic_word_break_characters variable
so that when we try and tab complete multiple matches Readline will still attempt to complete
the match. If we leave this as default Realine won&rsquo;t be able to complete a match that has a space
in it when it has multiple potential matches:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">init_readline</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    <span style="color: #5B6268;">/* </span><span style="color: #5B6268;">Allow ncurses to deal with signal handling and term prep</span><span style="color: #5B6268;"> */</span>
    rl_catch_signals  = <span style="color: #da8548; font-weight: bold;">0</span>;
    rl_catch_sigwinch = <span style="color: #da8548; font-weight: bold;">0</span>;

    rl_prep_term_function   = <span style="color: #a9a1e1;">NULL</span>;
    rl_deprep_term_function = <span style="color: #a9a1e1;">NULL</span>;

    <span style="color: #5B6268;">/* </span><span style="color: #5B6268;">Stop readline from changing the lines and cols environment variables</span><span style="color: #5B6268;"> */</span>
    rl_change_environment = <span style="color: #da8548; font-weight: bold;">0</span>;

    rl_getc_function = readline_getc;
    rl_input_available_hook = readline_is_input_available;
    rl_redisplay_function = redisplay;

    rl_completion_display_matches_hook = matches_suggestion_display;

    rl_attempted_completion_function = match_completion;
    rl_basic_word_break_characters = <span style="color: #98be65;">""</span>;

    rl_callback_handler_install<span style="color: #c678dd;">(</span><span style="color: #98be65;">"&gt; "</span>, callback_handler<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>

<p>
That&rsquo;s it! Now if you hit tab you will get a list of names from our
</p>
</div>
</div>
<div id="outline-container-org411ce31" class="outline-3">
<h3 id="org411ce31">The Final Program</h3>
<div class="outline-text-3" id="text-org411ce31">
<p>
Here is the full program if you want to simply copy paste this into your code editor/IDE of
choice to dig about in the code and see it actually run:
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">stdbool.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">stdlib.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">ncurses.h</span><span style="color: #51afef;">&gt;</span>
<span style="color: #51afef; font-weight: bold;">#include</span> <span style="color: #51afef;">&lt;</span><span style="color: #98be65;">readline/readline.h</span><span style="color: #51afef;">&gt;</span>

<span style="color: #51afef; font-weight: bold;">#define</span> <span style="color: #c678dd;">UNUSED</span><span style="color: #51afef;">(</span><span style="color: #dcaeea;">x</span><span style="color: #51afef;">)</span> <span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>x

<span style="color: #ECBE7B;">WINDOW</span> *<span style="color: #dcaeea;">input_window</span>, *<span style="color: #dcaeea;">output_window</span>;
<span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">lines</span>, <span style="color: #dcaeea;">cols</span>;

<span style="color: #ECBE7B;">unsigned</span> <span style="color: #ECBE7B;">char</span> <span style="color: #dcaeea;">input</span>;
<span style="color: #ECBE7B;">bool</span> <span style="color: #dcaeea;">input_available</span> = <span style="color: #a9a1e1;">false</span>;

<span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">my_match_list</span><span style="color: #51afef;">[]</span> = <span style="color: #51afef;">{</span>
    <span style="color: #98be65;">"Darth Vader"</span>,
    <span style="color: #98be65;">"Darth Sidious"</span>,
    <span style="color: #98be65;">"Han Solo"</span>,
    <span style="color: #98be65;">"Luke Skywalker"</span>,
    <span style="color: #98be65;">"Obi Wan Kenobi"</span>,
    <span style="color: #98be65;">"Princess Leia"</span>,
    <span style="color: #a9a1e1;">NULL</span> <span style="color: #5B6268;">/* </span><span style="color: #5B6268;">Last item has to be NULL for Readline</span><span style="color: #5B6268;"> */</span>
<span style="color: #51afef;">}</span>;

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">init_ncurses</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    initscr<span style="color: #c678dd;">()</span>;
    cbreak<span style="color: #c678dd;">()</span>;
    noecho<span style="color: #c678dd;">()</span>;
    keypad<span style="color: #c678dd;">(</span>stdscr, <span style="color: #a9a1e1;">TRUE</span><span style="color: #c678dd;">)</span>;

    getmaxyx<span style="color: #c678dd;">(</span>stdscr, lines, cols<span style="color: #c678dd;">)</span>;

    <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">start_x</span> = <span style="color: #da8548; font-weight: bold;">0</span>;
    <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">start_y</span> = <span style="color: #da8548; font-weight: bold;">0</span>;

    input_window  = newwin<span style="color: #c678dd;">(</span><span style="color: #da8548; font-weight: bold;">3</span>, cols, lines-<span style="color: #da8548; font-weight: bold;">3</span>, start_x<span style="color: #c678dd;">)</span>;
    output_window = newwin<span style="color: #c678dd;">(</span>lines - <span style="color: #da8548; font-weight: bold;">3</span>, cols, start_y, start_x<span style="color: #c678dd;">)</span>;

    keypad<span style="color: #c678dd;">(</span>input_window, <span style="color: #a9a1e1;">TRUE</span><span style="color: #c678dd;">)</span>;
    keypad<span style="color: #c678dd;">(</span>output_window, <span style="color: #a9a1e1;">TRUE</span><span style="color: #c678dd;">)</span>;

    box<span style="color: #c678dd;">(</span>input_window, <span style="color: #da8548; font-weight: bold;">0</span>, <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>;
    box<span style="color: #c678dd;">(</span>output_window, <span style="color: #da8548; font-weight: bold;">0</span>, <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">cleanup_ncurses</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    delwin<span style="color: #c678dd;">(</span>input_window<span style="color: #c678dd;">)</span>;
    delwin<span style="color: #c678dd;">(</span>output_window<span style="color: #c678dd;">)</span>;
    endwin<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">forward_to_readline</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">char</span> <span style="color: #dcaeea;">c</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    input = c;
    input_available = <span style="color: #a9a1e1;">true</span>;
    rl_callback_read_char<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">readline_getc</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">FILE</span> *<span style="color: #dcaeea;">fp</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    <span style="color: #a9a1e1;">UNUSED</span><span style="color: #c678dd;">(</span>fp<span style="color: #c678dd;">)</span>;

    input_available = <span style="color: #a9a1e1;">false</span>;
    <span style="color: #51afef;">return</span> input;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">readline_is_input_available</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    <span style="color: #51afef;">return</span> input_available;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">redisplay</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    werase<span style="color: #c678dd;">(</span>input_window<span style="color: #c678dd;">)</span>;
    box<span style="color: #c678dd;">(</span>input_window, <span style="color: #da8548; font-weight: bold;">0</span>, <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>;
    mvwprintw<span style="color: #c678dd;">(</span>input_window, <span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #98be65;">"%s%s"</span>, rl_display_prompt, rl_line_buffer<span style="color: #c678dd;">)</span>;

    wrefresh<span style="color: #c678dd;">(</span>output_window<span style="color: #c678dd;">)</span>;
    wrefresh<span style="color: #c678dd;">(</span>input_window<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">matches_suggestion_display</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">char</span> **<span style="color: #dcaeea;">matches</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">size</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">len</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    <span style="color: #a9a1e1;">UNUSED</span><span style="color: #c678dd;">(</span>len<span style="color: #c678dd;">)</span>;
    <span style="color: #a9a1e1;">UNUSED</span><span style="color: #c678dd;">(</span>size<span style="color: #c678dd;">)</span>;

    werase<span style="color: #c678dd;">(</span>output_window<span style="color: #c678dd;">)</span>;
    box<span style="color: #c678dd;">(</span>output_window, <span style="color: #da8548; font-weight: bold;">0</span>, <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #c678dd;">)</span>;

    <span style="color: #51afef;">for</span> <span style="color: #c678dd;">(</span><span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">i</span> = <span style="color: #da8548; font-weight: bold;">0</span>; matches<span style="color: #98be65;">[</span>i<span style="color: #98be65;">]</span>; ++i<span style="color: #c678dd;">)</span>
        mvwprintw<span style="color: #c678dd;">(</span>output_window, <span style="color: #da8548; font-weight: bold;">1</span> + i, <span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #98be65;">"%s"</span>, matches<span style="color: #98be65;">[</span>i<span style="color: #98be65;">]</span><span style="color: #c678dd;">)</span>;

    wrefresh<span style="color: #c678dd;">(</span>output_window<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">callback_handler</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">line</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    <span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">prev_line</span> = <span style="color: #a9a1e1;">NULL</span>;

    <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #51afef; font-weight: bold;">!</span>line<span style="color: #c678dd;">)</span>
        <span style="color: #51afef;">return</span>;

    free<span style="color: #c678dd;">(</span>prev_line<span style="color: #c678dd;">)</span>;
    prev_line = line;

    redisplay<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">char</span> *<span style="color: #c678dd;">matches_completion_generator</span><span style="color: #51afef;">(</span><span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">text</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">state</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    <span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">index</span>, <span style="color: #dcaeea;">len</span>;
    <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">name</span> = <span style="color: #a9a1e1;">NULL</span>;

    <span style="color: #51afef;">if</span> <span style="color: #c678dd;">(</span><span style="color: #51afef; font-weight: bold;">!</span>state<span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">{</span>
        index = <span style="color: #da8548; font-weight: bold;">0</span>;
        len = strlen<span style="color: #98be65;">(</span>text<span style="color: #98be65;">)</span>;
    <span style="color: #c678dd;">}</span>

    <span style="color: #51afef;">while</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span>name = my_match_list<span style="color: #a9a1e1;">[</span>index++<span style="color: #a9a1e1;">]</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">{</span>
        <span style="color: #51afef;">if</span> <span style="color: #98be65;">(</span>strncmp<span style="color: #a9a1e1;">(</span>name, text, len<span style="color: #a9a1e1;">)</span> == <span style="color: #da8548; font-weight: bold;">0</span><span style="color: #98be65;">)</span>
        <span style="color: #98be65;">{</span>
            <span style="color: #51afef;">return</span> strdup<span style="color: #a9a1e1;">(</span>name<span style="color: #a9a1e1;">)</span>;
        <span style="color: #98be65;">}</span>
    <span style="color: #c678dd;">}</span>

    <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">NULL</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">char</span> **<span style="color: #c678dd;">match_completion</span><span style="color: #51afef;">(</span><span style="color: #51afef;">const</span> <span style="color: #ECBE7B;">char</span> *<span style="color: #dcaeea;">text</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">start</span>, <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">end</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    <span style="color: #a9a1e1;">UNUSED</span><span style="color: #c678dd;">(</span>start<span style="color: #c678dd;">)</span>;
    <span style="color: #a9a1e1;">UNUSED</span><span style="color: #c678dd;">(</span>end<span style="color: #c678dd;">)</span>;

    rl_attempted_completion_over = <span style="color: #da8548; font-weight: bold;">1</span>;
    <span style="color: #51afef;">return</span> rl_completion_matches<span style="color: #c678dd;">(</span>text, matches_completion_generator<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">init_readline</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    <span style="color: #5B6268;">/* </span><span style="color: #5B6268;">Allow ncurses to deal with signal handling and term prep</span><span style="color: #5B6268;"> */</span>
    rl_catch_signals  = <span style="color: #da8548; font-weight: bold;">0</span>;
    rl_catch_sigwinch = <span style="color: #da8548; font-weight: bold;">0</span>;

    rl_prep_term_function   = <span style="color: #a9a1e1;">NULL</span>;
    rl_deprep_term_function = <span style="color: #a9a1e1;">NULL</span>;

    <span style="color: #5B6268;">/* </span><span style="color: #5B6268;">Stop readline from changing the lines and cols environment variables</span><span style="color: #5B6268;"> */</span>
    rl_change_environment = <span style="color: #da8548; font-weight: bold;">0</span>;

    rl_getc_function = readline_getc;
    rl_input_available_hook = readline_is_input_available;
    rl_redisplay_function = redisplay;

    rl_completion_display_matches_hook = matches_suggestion_display;

    rl_attempted_completion_function = match_completion;
    rl_basic_word_break_characters = <span style="color: #98be65;">""</span>;

    rl_callback_handler_install<span style="color: #c678dd;">(</span><span style="color: #98be65;">"&gt; "</span>, callback_handler<span style="color: #c678dd;">)</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">cleanup_readline</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    rl_callback_handler_remove<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">void</span> <span style="color: #c678dd;">main_loop</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    <span style="color: #ECBE7B;">int</span> <span style="color: #dcaeea;">ch</span>;
    <span style="color: #51afef;">while</span><span style="color: #c678dd;">(</span><span style="color: #98be65;">(</span>ch = wgetch<span style="color: #a9a1e1;">(</span>input_window<span style="color: #a9a1e1;">)</span><span style="color: #98be65;">)</span><span style="color: #c678dd;">)</span>
    <span style="color: #c678dd;">{</span>
        <span style="color: #51afef;">switch</span><span style="color: #98be65;">(</span>ch<span style="color: #98be65;">)</span>
        <span style="color: #98be65;">{</span>
            <span style="color: #51afef;">case</span> <span style="color: #a9a1e1;">KEY_BACKSPACE</span>:
                forward_to_readline<span style="color: #a9a1e1;">(</span><span style="color: #da8548; font-weight: bold;">127</span><span style="color: #a9a1e1;">)</span>;
                <span style="color: #51afef;">break</span>;
            <span style="color: #51afef;">default</span>:
                forward_to_readline<span style="color: #a9a1e1;">(</span>ch<span style="color: #a9a1e1;">)</span>;
        <span style="color: #98be65;">}</span>
    <span style="color: #c678dd;">}</span>
<span style="color: #51afef;">}</span>

<span style="color: #ECBE7B;">int</span> <span style="color: #c678dd;">main</span><span style="color: #51afef;">(</span><span style="color: #ECBE7B;">void</span><span style="color: #51afef;">)</span>
<span style="color: #51afef;">{</span>
    init_ncurses<span style="color: #c678dd;">()</span>;
    init_readline<span style="color: #c678dd;">()</span>;

    main_loop<span style="color: #c678dd;">()</span>;

    cleanup_readline<span style="color: #c678dd;">()</span>;
    cleanup_ncurses<span style="color: #c678dd;">()</span>;
<span style="color: #51afef;">}</span>
</pre>
</div>
</div>
</div>
</div>
</div>
</body>
</html>